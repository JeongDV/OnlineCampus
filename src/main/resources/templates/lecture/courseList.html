<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>강의보기 페이지</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css">
    <style>
        .active-row {
            background-color: black; /* 클릭된 행의 배경색 */
            color: white;
        }
    </style>
</head>
<body>
<div class="container" style="margin-top: 40px;">
    <h3 style="margin-left: 30px;">강의목록</h3>
    <div style="padding: 20px; border: 1px solid lightgray; border-radius: 10px; margin: 25px 10px;">
        <span class="allProgress" style="display: inline-block; margin-bottom: 20px;">전체 진도율</span>
        <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 75%;" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">75%</div>
        </div>
    </div>
    <div class="accordion accordion-flush" id="accordionExample">
        <div>
            <table class="table">
                <tr style="text-align: center; background-color: snow;">
                    <th style="width: 25%;">강의명</th>
                    <th style="width: 25%">강의운영기간</th>
                    <th style="width: 25%">진도율</th>
                    <th style="width: 25%">강의현황보기</th>
                </tr>
            </table>
        </div>
        <div class="w-100 accordion-item" th:each="course : ${courseList}">
            <table class="table accordion-header" th:id="'heading' + ${course.courseSeq}">
                <tr class="collapsed view-chapters-btn" data-bs-toggle="collapse" th:data-bs-target="'#collapse' + ${course.courseSeq}" th:aria-expanded="false" th:aria-controls="'collapse' + ${course.courseSeq}" th:id="${course.courseSeq}"  style="text-align: center;">
                    <td th:text="${course.courseName}" style="width: 25%"></td>
                    <td th:text="${course.startDateTime}+'~'+${course.endDateTime}" style="width: 25%"></td>
                    <td th:text="00" style="width: 25%"></td>
                    <td style="width: 25%">
                        <button type="button">보기</button>
                    </td>
                </tr>
            </table>
            <div th:id="'collapse' + ${course.courseSeq}" class="accordion-collapse collapse accordion-body" th:aria-labelledby="'heading' + ${course.courseSeq}" th:data-bs-parent="'#accordionExample'" style="padding: 0;">
                <table class="table" id="courseChapterTable"></table>
                <div>
                    <table class="table">
                        <tr>
                            <th>1차시</th>
                            <td>
                                <img src="../../static/img/example.png" width="80px" height="50px">
                            </td>
                            <th>학습시간</th>
                            <td>0시 0분 0초</td>
                            <th>진도율</th>
                            <td>0%</td>
                            <td>
                                <button type="button" class="startCourse" onclick="openModalAndPlayYoutube()">강의보기</button>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 강의 모달창 -->
<div id="courseModal" class="modal" style="display: none; margin-top: 80px;">
    <div class="modal-dialog">
        <div class="modal-content" style="width: 950px; height: 700px; position: relative; left: -45%; border: none;">
            <div class="modal-header">
                <h5 class="modal-title" style="font-weight: bold;">강의 차수명</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="youtubePlayer"></div>
                <iframe id="ytplayer" type="text/html" width="920" height="605"
                        src="https://www.youtube.com/watch?v=AgtBj7XVToQ"
                        frameborder="0" allowfullscreen></iframe>
            </div>
        </div>
    </div>
</div>

</body>
<!-- jQuery 라이브러리 -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.querySelector(".view-chapters-btn").addEventListener("click", function () {
        const courseSeq = $(this).attr('id');

        $.ajax({
            type: 'GET',
            url: "/ajax/getCourseChapter",
            data: JSON.stringify({
                "courseSeq": courseSeq
            }),
            dataType: "json",
            async: false,
            contentType: "application/json; charset=utf-8",
            success: function(response) {
                if(response.result === "success"){
                    const length = response.length;
                    const courseChapterTable = document.getElementById("courseChapterTable");
                    for(var i=0; i<length; i++){
                        let chapterRow = document.createElement("tr");
                        chapterRow.style.textAlign = "left";

                        let chapterNumberCell = document.createElement("td");
                        chapterNumberCell.colSpan = 5;
                        chapterNumberCell.innerHTML = courseSeq+"차시";

                        let emptyCell = document.createElement("td");

                        let viewButtonCell = document.createElement("td");
                        let viewButton = document.createElement("button");
                        viewButton.type = "button";
                        viewButton.className = "startCourse float-right";
                        viewButton.onclick = openModalAndPlayYoutube;
                        viewButton.innerHTML = "강의보기";
                        viewButtonCell.appendChild(viewButton);

                        chapterRow.appendChild(chapterNumberCell);
                        chapterRow.appendChild(emptyCell);
                        chapterRow.appendChild(viewButtonCell);

                        courseChapterTable.appendChild(chapterRow);
                    }
                }
            }
        });
    });

    // 강의보기 모달 열기
    function openModalAndPlayYoutube() {
        $('#courseModal').modal('show');
    }
    // 모달 닫기
    document.querySelector('#courseModal .close').addEventListener('click', function () {
        $('#courseModal').modal('hide');
    });

    // 클릭된 행 스타일 추가
    $(document).ready(function() {
        $('.accordion-header').click(function() {
            if ($(this).hasClass('active-row')) {
                $(this).removeClass('active-row');
            } else {
                $('.accordion-header').removeClass('active-row');
                $(this).addClass('active-row');
            }
        });
    });

</script>
<script src="https://www.youtube.com/iframe_api"></script>
</html>